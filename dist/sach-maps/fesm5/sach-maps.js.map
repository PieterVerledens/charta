{"version":3,"file":"sach-maps.js.map","sources":["ng://sach-maps/lib/googlemap/map/map.module.ts","ng://sach-maps/lib/googlemap/map/map.service.ts","ng://sach-maps/lib/googlemap/map/marker/marker.module.ts","ng://sach-maps/lib/googlemap/map/marker/enum/marker.enum.ts","ng://sach-maps/lib/googlemap/map/marker/models/marker.model.ts","ng://sach-maps/lib/googlemap/map/marker/marker.service.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n@NgModule({\r\n    imports: [\r\n        CommonModule\r\n    ]\r\n})\r\nexport class MapModule { }\r\n","import { Injectable, ElementRef } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { MapModule } from './map.module';\r\nimport { Observable } from 'rxjs/internal/Observable';\r\n\r\n/// <reference types=\"googlemaps\" />\r\n\r\n@Injectable({\r\n    providedIn: MapModule\r\n})\r\nexport class MapService {\r\n    private _map: google.maps.Map;\r\n    private _key: string;\r\n\r\n\r\n    constructor(\r\n        private http: HttpClient\r\n    ) { }\r\n\r\n    public get map(): google.maps.Map {\r\n        return this._map;\r\n    }\r\n\r\n    public get key(): string {\r\n        return this._key;\r\n    }\r\n\r\n    /**\r\n     * Loadmap\r\n     * @param mapElement html map elemnt\r\n     */\r\n    public init(\r\n        mapElement: ElementRef,\r\n        mapOptions: google.maps.MapOptions,\r\n        compass: boolean,\r\n        key: string\r\n    ): google.maps.Map {\r\n        this._key = key;\r\n        \r\n        this._map = new google.maps.Map(mapElement.nativeElement, mapOptions);\r\n        if (compass) {\r\n            this.addCompass();\r\n        }\r\n\r\n        const overlay = new google.maps.OverlayView();\r\n        overlay.draw = function () {\r\n            this.getPanes().markerLayer.id = 'markerLayer';\r\n        };\r\n        overlay.setMap(this.map);\r\n\r\n        return this.map;\r\n    }\r\n\r\n    // GEOCODING\r\n\r\n    public getGeocodeFromAddress(address: string): Observable<any> {\r\n        return this.http.get(\r\n            `https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=${\r\n            this.key\r\n            }`\r\n        );\r\n    }\r\n\r\n\r\n\r\n    public async getAddressFromGeocode(\r\n        location: google.maps.LatLng\r\n    ): Promise<any> {\r\n        return new Promise((resolve, reject) => {\r\n            const geocoder = new google.maps.Geocoder();\r\n            const latlng = location;\r\n            let address: google.maps.GeocoderResult;\r\n            geocoder.geocode({ location: latlng }, (results, status) => {\r\n                if (status === google.maps.GeocoderStatus.OK) {\r\n                    address = results[0];\r\n                    resolve(address.formatted_address);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    // Compass\r\n\r\n    addCompass() {\r\n        const div = document.createElement('div');\r\n        const icon =\r\n            'https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png';\r\n        div.innerHTML = '<img src=\"' + icon + '\"> ' + name;\r\n        this.map.controls[google.maps.ControlPosition.RIGHT_TOP].push(div);\r\n    }\r\n\r\n}\r\n","import { MarkerService } from './marker.service';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MapService } from '../map.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ]\r\n})\r\nexport class MarkerModule { }\r\n","export enum MarkerStateEnum {\r\n    CREATION,\r\n    EDIT,\r\n    IDLE\r\n}\r\n","\r\nimport { MarkerStateEnum } from '../enum/marker.enum';\r\nimport { MarkerService } from '../marker.service';\r\n\r\n/// <reference types=\"googlemaps\" />\r\n\r\n\r\nexport class Marker extends google.maps.Marker {\r\n\r\n    public state: MarkerStateEnum = MarkerStateEnum.IDLE;\r\n    public rotate?: number = 0;\r\n\r\n    /**\r\n     *\r\n     */\r\n    constructor(markerService: MarkerService, opts?: google.maps.MarkerOptions) {\r\n        super(opts);\r\n        this.addListener('click', event => {\r\n            markerService.setSelectedMarker(this);\r\n        });\r\n    }\r\n}\r\n","import { MarkerModule } from './marker.module';\r\nimport { Marker } from './models/marker.model';\r\nimport { Injectable } from '@angular/core';\r\nimport { MarkerStateEnum } from './enum/marker.enum';\r\n\r\n/// <reference types=\"googlemaps\" />\r\n\r\n@Injectable({\r\n    providedIn: MarkerModule\r\n})\r\nexport class MarkerService {\r\n    private selectedMarker: Marker;\r\n    private _markers: Marker[] = [];\r\n\r\n    private _markerCluster: MarkerClusterer;\r\n\r\n    public get markers(): Marker[] {\r\n        return this._markers;\r\n    }\r\n\r\n    public get markerCluster(): MarkerClusterer {\r\n        return this._markerCluster;\r\n    }\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    public createCluster(map: google.maps.Map) {\r\n        this._markerCluster = new MarkerClusterer(\r\n            map,\r\n            this.markers\r\n        );\r\n\r\n        this.markerCluster.setMaxZoom(16);\r\n    }\r\n\r\n    public registerMarkerOnClick(map: google.maps.Map) {\r\n        const marker = new Marker(this, {\r\n            position: new google.maps.LatLng(-1, -1),\r\n            map: map,\r\n            draggable: true,\r\n            clickable: true\r\n            // icon: {\r\n            //   url: \"assets/img/target_sami_medium.png\",\r\n            //   origin: new google.maps.Point(0, 0),\r\n            //   scaledSize: new google.maps.Size(250, 250)\r\n            // }\r\n        });\r\n        google.maps.event.addListener(\r\n            map,\r\n            'click',\r\n            event => {\r\n                marker.setPosition(event.latLng);\r\n                this.markerCluster.addMarker(marker);\r\n                this.addMarker(marker);\r\n                map.panTo(this.getLast().getPosition());\r\n            }\r\n        );\r\n        return marker;\r\n    }\r\n\r\n    public getGeocodeFromSelectedMarker(): google.maps.LatLng {\r\n        return this.selectedMarker.getPosition();\r\n    }\r\n\r\n    public findByIndex(index: number): Marker {\r\n        if (this._markers[index]) {\r\n            return this._markers[index];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getLast(): Marker {\r\n        return this._markers[this._markers.length - 1];\r\n    }\r\n\r\n    public countMarkers(): number {\r\n        return this._markers.length;\r\n    }\r\n\r\n    public setSelectedMarker(marker: Marker): void {\r\n        this.selectedMarker = this._markers.find(x => x === marker);\r\n    }\r\n\r\n    public get getMarkerInCreationState(): Marker {\r\n        return this._markers.find(x => x.state === MarkerStateEnum.CREATION);\r\n    }\r\n\r\n    public addMarker(marker: Marker) {\r\n        marker.state = MarkerStateEnum.CREATION;\r\n        this._markers.push(marker);\r\n        this.selectedMarker = marker;\r\n    }\r\n\r\n    public rotateMarker(clockwise: boolean): void {\r\n        const markerIndex = this._markers.findIndex(\r\n            x => x === this.selectedMarker\r\n        );\r\n        const elements: NodeListOf<Element> = document.querySelectorAll(\r\n            '#markerLayer img'\r\n        );\r\n        const element: any = elements[markerIndex];\r\n        if (clockwise) {\r\n            this._markers[markerIndex].rotate += 7;\r\n            element.style.transform =\r\n                'rotate(' + this._markers[markerIndex].rotate + 'deg)';\r\n        } else {\r\n            this._markers[markerIndex].rotate -= 7;\r\n            element.style.transform =\r\n                'rotate(' + this._markers[markerIndex].rotate + 'deg)';\r\n        }\r\n    }\r\n\r\n    public deleteMarker(): void {\r\n        const marker: Marker = this._markers[this._markers.length - 1];\r\n        if (marker.state === MarkerStateEnum.CREATION) {\r\n            marker.setMap(null);\r\n            this._markers = this._markers.slice(0, this.countMarkers() - 1);\r\n            this.selectedMarker = null;\r\n        }\r\n    }\r\n\r\n    public hideMarker(marker: Marker): void {\r\n        marker.setMap(null);\r\n    }\r\n\r\n    public saveMarker(): void {\r\n        const marker: Marker = this.getLast();\r\n        marker.state = MarkerStateEnum.IDLE;\r\n        this.selectedMarker = null;\r\n    }\r\n}\r\n"],"names":["tslib_1.__extends"],"mappings":"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"}
